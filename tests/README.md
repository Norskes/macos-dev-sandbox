# –¢–µ—Å—Ç–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¢–µ—Å—Ç–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ **CI —Ç–µ—Å—Ç—ã** –∏ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

## üöÄ CI –¢–µ—Å—Ç—ã (tests/ci/)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–µ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è GitHub Actions
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~10-15 —Å–µ–∫—É–Ω–¥
**–°—Ä–µ–¥–∞:** –õ—é–±–∞—è (Linux, macOS, Windows)

```bash
./run_ci_tests.sh
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç:

- ‚úÖ –õ–æ–≥–∏–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (`get_relative_path`, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- ‚úÖ Docker —É—Ç–∏–ª–∏—Ç—ã (–ø–æ–∏—Å–∫ –ø–æ—Ä—Ç–æ–≤, –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö (–º–∞—Å—Å–∏–≤—ã, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –ú–æ–∫–∞—é—Ç –≤–Ω–µ—à–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (`docker`, `git`, `lsof`)
- –ù–µ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- –†–∞–±–æ—Ç–∞—é—Ç –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç —á–∏—Å—Ç—É—é –ª–æ–≥–∏–∫—É –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (tests/integration/)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω—ã–µ end-to-end —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~30-60 —Å–µ–∫—É–Ω–¥
**–°—Ä–µ–¥–∞:** –¢–æ–ª—å–∫–æ macOS —Å `sandbox-exec`

```bash
./run_tests.sh
```

### –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç:

- ‚úÖ –†–µ–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É `sandbox-exec` –∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É sandbox –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ Docker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- –°–æ–∑–¥–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ sandbox –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç end-to-end workflow
- –¢—Ä–µ–±—É—é—Ç –ø–æ–ª–Ω—É—é —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø —Ç–µ—Å—Ç–∞      | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –§–∞–π–ª—ã                | –í—Ä–µ–º—è    |
| -------------- | ---------- | -------------------- | -------- |
| CI —Ç–µ—Å—Ç—ã       | 14         | `ci/*.bats`          | ~15s     |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ | 19         | `integration/*.bats` | ~45s     |
| **–í—Å–µ–≥–æ**      | **33**     |                      | **~60s** |

## üîÑ GitHub Actions

Workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç **—Ç–æ–ª—å–∫–æ CI —Ç–µ—Å—Ç—ã** –Ω–∞ `ubuntu-latest`:

1. **–õ–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
2. **–ë—ã—Å—Ç—Ä–æ –∏ –¥—ë—à–µ–≤–æ** - –Ω–µ—Ç —Å–º—ã—Å–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å macOS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞ GitHub

```yaml
# .github/workflows/ci.yml
jobs:
  ci-tests:
    runs-on: ubuntu-latest # –¢–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞, –±–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–ª–æ–∫–∞–ª—å–Ω–æ** –ø–µ—Ä–µ–¥ commit:

```bash
./tests/run_tests.sh  # –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ macOS
```

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CI —Ç–µ—Å—Ç–∞:

```bash
# tests/ci/new_logic.bats
@test "new function works correctly" {
    # –ú–æ–∫–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    function external_cmd() { echo "mocked"; }
    export -f external_cmd

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–≥–∏–∫—É
    result=$(my_function "input")
    [ "$result" = "expected" ]
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:

```bash
# tests/integration/new_feature.bats
load test_helper

setup() {
    setup_common  # –°–æ–∑–¥–∞—ë—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
}

@test "new feature works end-to-end" {
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
    run real_command_with_sandbox
    [ "$status" -eq 0 ]
}
```

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã

1. **CI —Ç–µ—Å—Ç—ã** = –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** = —Ä–µ–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** –≤ CI
4. **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º
5. **–ò–∑–æ–ª—è—Ü–∏—è** —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ä–µ–¥
